<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fungi Prices</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Fungi Prices</h1>
        </div>

        <div class="search-container">
            <input 
                type="text" 
                id="searchInput" 
                class="search-input" 
                placeholder="Search by title, author, brand, or SKU..."
                autocomplete="off"
            >
        </div>

        <div id="loadingMessage" class="loading">
            Loading inventory data...
        </div>

        <div id="errorMessage" class="error" style="display: none;">
            <strong>CSV File Not Found</strong>
            <p>Please create an <code>items.csv</code> file in the same directory as this HTML file.</p>
            <p><strong>Required format:</strong></p>
            <pre>sku,title,author,brand,price
12345,"Book Title","Author Name","Publisher",19.99</pre>
            <p>Make sure your CSV file has exactly these column headers: <strong>sku, title, author, brand, price</strong></p>
        </div>

        <div id="resultsContainer" style="display: none;">
            <div class="results-header">
                <span id="resultsCount" class="results-count"></span>
                <span class="sort-info">Sorted by SKU (newest first)</span>
            </div>
            <div id="itemGrid" class="item-grid"></div>
        </div>

        <div id="noResults" class="no-results" style="display: none;">
            <h3>No matches found</h3>
            <p>Try a different search term or check your spelling</p>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            var searchInput = document.getElementById('searchInput');
            var loadingMessage = document.getElementById('loadingMessage');
            var errorMessage = document.getElementById('errorMessage');
            var resultsContainer = document.getElementById('resultsContainer');
            var noResults = document.getElementById('noResults');
            var itemGrid = document.getElementById('itemGrid');
            var resultsCount = document.getElementById('resultsCount');
            var allItems = [];

            function loadData() {
                fetch('items.csv')
                    .then(function(response) {
                        if (!response.ok) {
                            throw new Error('Failed to load CSV');
                        }
                        return response.text();
                    })
                    .then(function(text) {
                        var lines = text.split(/\r?\n/);
                        
                        for (var i = 1; i < lines.length; i++) {
                            if (lines[i].trim()) {
                                var values = lines[i].split(',');
                                if (values.length >= 5) {
                                    allItems.push({
                                        sku: values[0] || '',
                                        title: values[1] || '',
                                        author: values[2] || '',
                                        brand: values[3] || '',
                                        price: values[4] || ''
                                    });
                                }
                            }
                        }
                        
                        allItems.sort(function(a, b) {
                            return b.sku.localeCompare(a.sku, undefined, { numeric: true });
                        });
                        
                        showItems(allItems);
                    })
                    .catch(function(error) {
                        loadingMessage.style.display = 'none';
                        errorMessage.style.display = 'block';
                    });
            }
            
            function showItems(items) {
                loadingMessage.style.display = 'none';
                resultsContainer.style.display = 'block';
                noResults.style.display = 'none';
                
                resultsCount.textContent = items.length + ' items';
                
                itemGrid.innerHTML = '';
                
                for (var i = 0; i < items.length; i++) {
                    var item = items[i];
                    var card = document.createElement('div');
                    card.className = 'item-card';
                    
                    var info = document.createElement('div');
                    info.className = 'item-info';
                    
                    var title = document.createElement('div');
                    title.className = 'item-title';
                    title.textContent = item.title || 'No title';
                    info.appendChild(title);
                    
                    var details = document.createElement('div');
                    details.className = 'item-details';
                    
                    if (item.author) {
                        var authorLine = document.createElement('div');
                        authorLine.className = 'item-detail-line';
                        authorLine.textContent = item.author;
                        details.appendChild(authorLine);
                    }
                    
                    if (item.brand) {
                        var brandLine = document.createElement('div');
                        brandLine.className = 'item-detail-line';
                        brandLine.textContent = item.brand;
                        details.appendChild(brandLine);
                    }
                    
                    info.appendChild(details);
                    card.appendChild(info);
                    
                    var priceDiv = document.createElement('div');
                    priceDiv.className = 'item-price';
                    var priceNum = parseFloat(item.price);
                    if (item.price && !isNaN(priceNum)) {
                        priceDiv.textContent = 'CHF ' + priceNum.toFixed(2);
                    } else {
                        priceDiv.textContent = 'Price not available';
                    }
                    card.appendChild(priceDiv);
                    
                    itemGrid.appendChild(card);
                }
            }
            
            function searchItems() {
                var query = searchInput.value.toLowerCase().trim();
                
                if (!query) {
                    showItems(allItems);
                    return;
                }
                
                var filtered = [];
                for (var i = 0; i < allItems.length; i++) {
                    var item = allItems[i];
                    var searchText = (item.title + ' ' + item.author + ' ' + item.brand + ' ' + item.sku).toLowerCase();
                    
                    if (searchText.indexOf(query) >= 0) {
                        filtered.push(item);
                    }
                }
                
                if (filtered.length === 0) {
                    resultsContainer.style.display = 'none';
                    noResults.style.display = 'block';
                } else {
                    showItems(filtered);
                }
            }
            
            if (searchInput) {
                searchInput.addEventListener('input', searchItems);
            }
            
            // Set up clear button if it exists
            var clearButton = document.getElementById('clearButton');
            if (clearButton) {
                clearButton.addEventListener('click', clearSearch);
            }
            
            loadData();
        });
    </script>
</body>
</html>